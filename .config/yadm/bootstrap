#!/bin/bash

system_type=$(uname -s)

cd "$HOME"
yadm submodule update --recursive --init

function install_arch() {
	MIRRORLIST="https://archlinux.org/mirrorlist/?country=NL&country=DE&protocol=http&protocol=https&ip_version=4&ip_version=6"
	sudo curl -o /etc/pacman.d/mirrorlist "$MIRRORLIST"
	sudo sed -i 's/#Server/Server/g' /etc/pacman.d/mirrorlist && sudo pacman -Syu --noconfirm
	sudo sed -i 's/#Color/Color/g' /etc/pacman.conf

	if ! command -v yay > /dev/null 2>&1; then
		echo "Install yay..."
		rm -rf /tmp/yay && \
		  git clone --depth 1 https://aur.archlinux.org/yay-bin.git /tmp/yay && \
		  cd /tmp/yay && \
		  makepkg -si --noconfirm
	fi

	echo "Installing packages from .packages"
	yay -S --needed --noconfirm --removemake - < $HOME/.packages
}

case "$system_type" in
	"Linux")
		install_arch;;
	*)
		echo "Cannot detect the system...";;
esac
